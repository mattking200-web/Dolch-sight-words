<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dolch Word Master</title>
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --light: #f5f6fa;
            --dark: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            text-align: center;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin-bottom: 10px; }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }
        .stat-value { color: var(--primary); font-weight: bold; }

        /* Mode Selector */
        .mode-selector {
            margin-bottom: 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
        }

        .mode-btn {
            padding: 8px 16px;
            border: 2px solid transparent;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            background-color: #e0e0e0;
            color: #555;
            transition: all 0.2s;
        }

        .mode-btn:hover { background-color: #d0d0d0; }
        
        .mode-btn.active-mode { 
            background-color: var(--primary); 
            color: white; 
            border-color: var(--dark);
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }

        /* Game Area */
        .game-area {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 400px;
        }

        /* Word Display Area */
        .word-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            min-height: 100px;
            position: relative;
        }

        .word-display {
            font-size: 4rem;
            font-weight: bold;
            color: var(--dark);
        }

        /* Hear It Button */
        .hear-btn {
            background: var(--warning);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .hear-btn:active { transform: scale(0.9); }

        /* Specific Mode Styles */
        .flashcard-hidden { visibility: hidden; }
        .sentence-display { font-size: 1.8rem; color: #555; line-height: 1.4; }
        .highlight-word { color: var(--primary); text-decoration: underline; }
        .scramble { letter-spacing: 15px; color: #888; }

        /* Feedback Area */
        .feedback-msg {
            font-size: 1.2rem;
            height: 30px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .success { color: var(--success); }
        .failure { color: var(--danger); }

        /* Microphone Button */
        .mic-container {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .mic-btn {
            font-size: 2.5rem;
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: none;
            background: var(--light);
            color: var(--dark);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .mic-btn:active { transform: scale(0.95); }
        
        .mic-btn.listening {
            background-color: var(--danger);
            color: white;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Progress Dots */
        .mastery-dots {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #eee;
            border: 1px solid #ddd;
        }
        .dot.filled { background-color: var(--success); border-color: var(--success); }

    </style>
</head>
<body>

    <h1>üìö Dolch Word Master</h1>

    <div class="stats-bar">
        <div>Learning: <span id="learning-count" class="stat-value">0</span></div>
        <div>Mastered: <span id="mastered-count" class="stat-value">0</span></div>
        <div>Streak: <span id="streak" class="stat-value">0</span></div>
    </div>

    <div class="mode-selector">
        <button onclick="changeMode('standard')" id="btn-standard" class="mode-btn active-mode">1. Read</button>
        <button onclick="changeMode('flash')" id="btn-flash" class="mode-btn">2. Flash Card</button>
        <button onclick="changeMode('sentence')" id="btn-sentence" class="mode-btn">3. Sentence</button>
        <button onclick="changeMode('spelling')" id="btn-spelling" class="mode-btn">4. Scramble</button>
        <button onclick="changeMode('listen')" id="btn-listen" class="mode-btn">5. Listen</button>
    </div>

    <div class="game-area">
        
        <div id="display-container">
            </div>

        <div id="feedback" class="feedback-msg">Press Mic to Read</div>

        <div class="mic-container">
            <button id="mic-trigger" class="mic-btn" onclick="toggleListen()">üé§</button>
            <p style="font-size: 0.8rem; color: #999; margin-top: 10px;">
                (Supports Chrome, Edge, Safari)
            </p>
        </div>
    </div>

<script>
    // --- Data ---
    const dolchWords = [
        "the", "to", "and", "a", "i", "you", "it", "in", "said", "for", "up", "look", "is", "go", "we", "little", "down", "can", "see", "not", "one", "my", "me", "big", "come", "blue", "red", "where", "jump", "away", "here", "help", "make", "yellow", "two", "play", "run", "find", "three", "funny"
    ];

    // Homophones Mapping: Corrects speech-to-text errors
    const homophones = {
        "to": ["two", "too", "2"],
        "two": ["to", "too", "2"],
        "see": ["sea", "c"],
        "i": ["eye", "aye"],
        "be": ["bee", "b"],
        "for": ["four", "4", "fore"],
        "one": ["won", "1"],
        "three": ["3"],
        "red": ["read"],
        "blue": ["blew"],
        "here": ["hear"],
        "no": ["know"],
        "in": ["inn"],
        "sun": ["son"],
        "a": ["hey", "ay"] 
    };

    const sentences = {
        "the": "The cat is black.", "to": "Go to the store.", "and": "Mom and Dad.", "a": "I see a dog.", "i": "I am happy.", "you": "Are you ready?", "it": "It is hot.", "in": "Put it in the box.", "said": "He said hello.", "for": "This is for you.", "up": "Look up there.", "look": "Look at me.", "is": "He is running.", "go": "Let's go home.", "we": "We are friends.", "little": "A little mouse.", "down": "Sit down please.", "can": "I can jump.", "see": "I see you.", "not": "Do not stop.", "one": "I have one apple.", "my": "That is my toy.", "me": "Give it to me.", "big": "A big truck.", "come": "Come here.", "blue": "The sky is blue.", "red": "A red ball.", "where": "Where are you?", "jump": "Jump high.", "away": "Go away.", "here": "I am here.", "help": "Please help me.", "make": "Make a cake.", "yellow": "A yellow sun.", "two": "I have two hands.", "play": "Let's play tag.", "run": "Run fast.", "find": "Find the ball.", "three": "One, two, three.", "funny": "That is funny."
    };

    // --- State ---
    let state = {
        activePool: [],      
        mastered: [],        
        queue: [...dolchWords], 
        currentWord: null,
        currentMode: 'standard',
        streak: 0,
        isListening: false
    };

    // --- Initialization ---
    function init() {
        for(let i=0; i<3; i++) addNewWord();
        nextTurn();
    }

    function addNewWord() {
        if(state.queue.length > 0) {
            const word = state.queue.shift();
            state.activePool.push({ text: word, successCount: 0 });
        }
    }

    function nextTurn() {
        updateStats();

        // 20% chance to review mastered word
        const reviewRoll = Math.random();
        
        if (state.mastered.length > 0 && reviewRoll < 0.2) {
            const randomIndex = Math.floor(Math.random() * state.mastered.length);
            state.currentWord = state.mastered[randomIndex];
            state.currentWord.isReview = true;
        } else {
            if (state.activePool.length === 0) addNewWord(); 
            const randomIndex = Math.floor(Math.random() * state.activePool.length);
            state.currentWord = state.activePool[randomIndex];
            state.currentWord.isReview = false;
        }

        renderMode();
    }

    // --- Mode Handling ---
    function changeMode(mode) {
        state.currentMode = mode;
        // Update Buttons
        document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active-mode'));
        const activeBtn = document.getElementById(`btn-${mode}`);
        if(activeBtn) activeBtn.classList.add('active-mode');
        
        // Force Re-render
        renderMode();
    }

    function renderMode() {
        const container = document.getElementById('display-container');
        const feedback = document.getElementById('feedback');
        const word = state.currentWord.text;
        
        // Reset Feedback
        feedback.innerText = "Press Mic to Read";
        feedback.className = "feedback-msg";

        // Dots Generation
        let dotsHtml = `<div class="mastery-dots">`;
        if (state.currentWord.isReview) {
            dotsHtml += `<span>‚≠ê Reviewing Mastered Word</span>`;
        } else {
            for(let i=0; i<3; i++) {
                dotsHtml += `<div class="dot ${state.currentWord.successCount > i ? 'filled' : ''}"></div>`;
            }
        }
        dotsHtml += `</div>`;

        // The "Hear It" Button HTML
        const hearBtn = `<button onclick="speakTarget()" class="hear-btn" title="Listen to word">üîä</button>`;

        let content = '';

        // Strategy Rendering
        switch(state.currentMode) {
            case 'standard':
                content = `
                    <div class="word-container">
                        <div class="word-display">${word}</div>
                        ${hearBtn}
                    </div>
                    ${dotsHtml}`;
                break;

            case 'flash':
                content = `
                    <div class="word-container">
                        <div id="flash-word" class="word-display">${word}</div>
                        ${hearBtn}
                    </div>
                    <div style="color:#666; font-style:italic">Memorize it...</div>
                    ${dotsHtml}`;
                
                // Hide after 1.5 seconds
                setTimeout(() => {
                    const el = document.getElementById('flash-word');
                    if(el) el.classList.add('flashcard-hidden');
                }, 1500);
                break;

            case 'sentence':
                const sent = sentences[word] || `I see the ${word}.`;
                // Highlight logic
                const parts = sent.split(new RegExp(`\\b${word}\\b`, 'i'));
                let sentHtml = sent;
                if(parts.length > 1) {
                    sentHtml = `${parts[0]}<span class="highlight-word">${word}</span>${parts[1]}`;
                }

                content = `
                    <div class="word-container">
                        <div class="sentence-display">${sentHtml}</div>
                        ${hearBtn}
                    </div>
                    ${dotsHtml}`;
                break;

            case 'spelling':
                const scrambled = word.split('').sort(() => 0.5 - Math.random()).join('  ');
                content = `
                    <div class="word-container">
                        <div class="word-display scramble">${scrambled}</div>
                        ${hearBtn}
                    </div>
                    <div style="color:#666;">Unscramble and say the word</div>
                    ${dotsHtml}`;
                break;

            case 'listen':
                content = `
                    <div class="word-container">
                        <div class="word-display" style="font-size:3rem">üéß Listen</div>
                        ${hearBtn}
                    </div>
                    <div style="color:#666;">Click the speaker, then say it back</div>
                    ${dotsHtml}`;
                // Auto speak in listen mode
                setTimeout(speakTarget, 500);
                break;
        }

        container.innerHTML = content;
    }

    function speakTarget() {
        const word = state.currentWord.text;
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.rate = 0.9; // Slightly slower for clarity
        window.speechSynthesis.speak(utterance);
    }

    // --- Result Processing ---
    function processResult(isCorrect) {
        const feedback = document.getElementById('feedback');
        const wordObj = state.currentWord;

        if (isCorrect) {
            feedback.innerHTML = "‚ú® Correct! Great job.";
            feedback.className = "feedback-msg success";
            state.streak++;

            if (!wordObj.isReview) {
                wordObj.successCount++;
                if (wordObj.successCount >= 3) {
                    state.mastered.push(wordObj);
                    state.activePool = state.activePool.filter(w => w.text !== wordObj.text);
                    addNewWord();
                    feedback.innerHTML = "üèÜ Word Mastered!";
                }
            }
            setTimeout(nextTurn, 1500);
        } else {
            feedback.innerHTML = "Try again!";
            feedback.className = "feedback-msg failure";
            state.streak = 0;

            if (wordObj.isReview) {
                // Return to learning pool
                state.mastered = state.mastered.filter(w => w.text !== wordObj.text);
                wordObj.successCount = 1; 
                wordObj.isReview = false;
                state.activePool.push(wordObj);
            }
        }
        updateStats();
    }

    function updateStats() {
        document.getElementById('learning-count').innerText = state.activePool.length;
        document.getElementById('mastered-count').innerText = state.mastered.length;
        document.getElementById('streak').innerText = state.streak;
    }

    // --- Speech Recognition ---
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const micBtn = document.getElementById('mic-trigger');

    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.lang = 'en-US';
        recognition.interimResults = false;
        recognition.maxAlternatives = 3; // Get top 3 guesses

        recognition.onstart = () => {
            state.isListening = true;
            micBtn.classList.add('listening');
            document.getElementById('feedback').innerText = "Listening...";
        };

        recognition.onend = () => {
            state.isListening = false;
            micBtn.classList.remove('listening');
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase().trim();
            const target = state.currentWord.text.toLowerCase();
            
            console.log("Heard:", transcript, "Target:", target);

            // Check Exact Match
            let match = (transcript === target);

            // Check Homophones
            if (!match && homophones[target]) {
                if (homophones[target].includes(transcript)) {
                    match = true;
                }
            }

            // Check phrase containment (e.g. user says "It is to" instead of just "to")
            if (!match && transcript.split(' ').includes(target)) {
                 match = true;
            }

            if (match) {
                processResult(true);
            } else {
                document.getElementById('feedback').innerText = `I heard: "${transcript}"`;
                // Allow a retry without immediate penalty or visual failure immediately
                setTimeout(() => {
                    if(document.getElementById('feedback').innerText.includes("heard")) {
                         processResult(false);
                    }
                }, 1500);
            }
        };

        window.toggleListen = () => {
            if (state.isListening) recognition.stop();
            else recognition.start();
        };
    } else {
        micBtn.style.display = 'none';
        document.getElementById('feedback').innerHTML = "‚ö†Ô∏è Browser not supported. Use Chrome.";
    }

    // Start
    init();

</script>
</body>
</html>
